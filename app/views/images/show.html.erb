<div class="row">

	<%= render 'layouts/sidebar', categories: Category.all%>
    
    <div class="col-sm-9">
    	<div class="text-center">
    		<div class="post-image">
        		<%= attachment_image_tag @image, :image, size: "800x500", format: 'jpeg', class: "img-thumbnail" %>
            </div>
            <div class="caption-text">
            	<%= @image.caption %>
            </div>
            <div class="favorite">
                <% if @image.favorited_by?(current_user) %>
                    <li>
                        <%= link_to image_favorite_path(@image), method: :delete do %>
                            <i class="fa fa-heart" aria-hidden = "true" style = "color: red;" ></i>
                            <%= @image.favorites.count %>
                        <% end %>
                    </li>
                <% else %>
                    <li>
                        <%= link_to image_favorites_path(@image), method: :post do %>
                            <li class="fa fa-heart-o" aria-hedden = "true" ></li>
                            <%= @image.favorites.count %>
                        <% end %>
                    </li>
                <% end %>
            </div>
            <div id= 'map'></div>
            <script>
                let map
                    let geocoder

                    function initMap(){
                      // geocoderを初期化
                      geocoder = new google.maps.Geocoder()
                    　var test ={lat: <%= @image.latitude %>, lng: <%= @image.longitude %>};
                      map = new google.maps.Map(document.getElementById('map'), {
                      center: test,
                      zoom: 8
                      });
                    }

                    function codeAddress(){
                      // 入力を取得
                      let inputAddress = document.getElementById('address').value;

                      // geocodingしたあとmapを移動
                      geocoder.geocode( { 'address': inputAddress}, function(results, status) {
                        if (status == 'OK') {
                    　　　　　　　　　　　　// map.setCenterで地図が移動
                          map.setCenter(results[0].geometry.location);

                    　　　　　　　　　　　　// google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
                          var marker = new google.maps.Marker({
                                map: map,
                                position: results[0].geometry.location
                            });

                        } else {
                          alert('Geocode was not successful for the following reason: ' + status);
                        }
                      });
                    }
            </script>
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBITQ4XcXfyuSbyCPHweISwuVjnFLCIV4Y&callback=initMap" async defer></script>
            <br>
            <%= @image.address %>
            <br>
            <div class="edit">
            	<%= link_to "投稿を編集する", edit_image_path(@image) %>
            </div>
            <div class="destroy">
                <%= link_to "投稿を削除する", image_path(@image), method: :delete %>
            </div>

            <br>

            <% @image.comments.each do |comment| %>
                <li class="comment">
                    <div class="comment-boby bb">
                        <div class="comment-avatar">
                            <div class="avatar">
                                <%= attachment_image_tag comment.user, :profile_image,  :fill, 100, 100, format: 'jpeg', class: "img-circle pull-left profile-img", fallback: "no_image.jpg" %>
                            </div>
                        </div>
                        <div class="comment-text">
                            <%= comment.comment %>
                        </div>
                        <% if comment.user == current_user %>
                        <div>
                            <%= link_to "削除する", image_comment_path(comment.image, comment), method: :delete, class: "btn btn-danger pull-right" %>
                        </div>
                        <% end %>
                    </div>
                </li>
            <% end %>
            <%= form_for [@image, @comment] do |f| %>
                <div class="row">
                    <div class="col-sm-12">
                        <%= f.text_area :comment, class: "btn-block" %>
                    </div>
                </div>
                <%= f.submit "送信する", class: "btn btn-lg btn-base-1 mt-20 pull-right" %>
            <% end %>
    	</div>
    </div>
</div>